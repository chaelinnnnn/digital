<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Store → Receipt Flow</title>

<style>
  body {
    margin: 0;
    background: #0f0f0f;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    color: white;
    height: 100vh;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* ===== STORE (Stage 0) ===== */

  #store {
    width: 600px;
    height: 480px;
    border-radius: 20px;
    background: #1a1a1a;
    border: 1px solid #333;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 18px;
    padding: 20px;
    position: relative;
    z-index: 3;
  }

  .item {
    background: rgba(255,255,255,0.05);
    border-radius: 14px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: 0.25s;
    border: 1px solid rgba(255,255,255,0.08);
  }

  .item:hover {
    background: rgba(255,255,255,0.12);
    transform: translateY(-4px);
  }

  .item img {
    width: 90px;
    margin-bottom: 12px;
    opacity: 0.9;
  }

  /* ===== PRINTER SCREEN ===== */

  #printerStage {
    position: fixed;
    inset: 0;
    background: white;
    display: none;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    z-index: 10;
  }

  #slot {
    width: 500px;
    z-index: 2;
  }

  #printReceipt {
    position: absolute;
    width: 240px;
    top: 50%;
    transform: translateY(-10px);
    opacity: 0;
  }

</style>
</head>
<body>

<!-- ========== STAGE 0: STORE ========== -->
<div id="store">
  <div class="item" data-receipt="receipt1.png">
    <img src="coffee.png" />
    캡슐커피
  </div>

  <div class="item" data-receipt="receipt2.png">
    <img src="phone.png" />
    스마트폰
  </div>

  <div class="item" data-receipt="receipt3.png">
    <img src="ikea.png" />
    이케아 가구
  </div>

  <div class="item" data-receipt="receipt4.png">
    <img src="tshirt.png" />
    패스트패션 티셔츠
  </div>
</div>

<!-- ========== STAGE 1: PRINTER OUTPUT ========== -->
<div id="printerStage">
  <img id="slot" src="slot.png" />
  <img id="printReceipt" src="" />
</div>


<script>
const store = document.getElementById("store");
const printerStage = document.getElementById("printerStage");
const printReceipt = document.getElementById("printReceipt");

document.querySelectorAll(".item").forEach(btn => {
  btn.addEventListener("click", () => {
    const receiptImage = btn.dataset.receipt;

    // 0) store fade-out
    store.style.transition = "opacity 0.6s ease";
    store.style.opacity = 0;

    setTimeout(() => {
      store.style.display = "none";

      // 1) show printerStage
      printerStage.style.display = "flex";
      printReceipt.src = receiptImage;

      // 2) animate receipt coming out
      setTimeout(() => {
        printReceipt.animate([
          { transform: "translateY(-20px)", opacity: 0 },
          { transform: "translateY(140px)", opacity: 1 }
        ], {
          duration: 1800,
          easing: "ease-out",
          fill: "forwards"
        });
      }, 500);

    }, 600);
  });
});
</script>

</body>
</html>

<style>
  /* 기본 설정 그대로 유지 */

  #pullStage {
    position: fixed;
    inset: 0;
    background: white;
    display: none;
    justify-content: center;
    align-items: flex-start;
    overflow: hidden;
    z-index: 20;
  }

  #pullReceipt {
    width: 240px;
    position: absolute;
    top: 200px;  /* 반 정도 나온 상태 */
    cursor: grab;
    user-select: none;
    transition: none;
  }

  #pullReceipt:active {
    cursor: grabbing;
  }
</style>

<!-- STAGE 1: PULL RECEIPT -->
<div id="pullStage">
  <img id="slot2" src="slot.png" style="width: 500px; margin-top: 0;">
  <img id="pullReceipt" src="receipt1.png">
</div>

<script>
let pullStage = document.getElementById("pullStage");
let pullReceipt = document.getElementById("pullReceipt");

let pulling = false;
let startY = 0;
let receiptY = 200;   // 초기 반쯤 나온 상태
let maxPull = 600;    // 완전히 빠져나오는 지점

// Stage1 시작 함수 (Stage0 → Stage1 연결 시 사용)
function startPullStage(selectedReceipt) {
  pullReceipt.src = selectedReceipt;  // 사용자 선택 제품의 영수증 이미지
  pullStage.style.display = "flex";
}

// Drag Start
pullReceipt.addEventListener("mousedown", e => {
  pulling = true;
  startY = e.clientY;
  receiptY = parseFloat(pullReceipt.style.top);
});

// Drag Move
window.addEventListener("mousemove", e => {
  if (!pulling) return;

  let dy = e.clientY - startY;
  let newY = receiptY + dy;

  // 영수증은 위로 못 올라감
  newY = Math.max(200, newY);

  pullReceipt.style.top = newY + "px";

  // 충분히 당겨지면 Stage2로 넘어가기
  if (newY > maxPull) {
    completePull();
  }
});

// Drag End
window.addEventListener("mouseup", () => pulling = false);


// Stage CLEAR
function completePull() {
  pulling = false;

  // 당기는 느낌을 유지하고 자연스럽게 아래로 떨어뜨림
  pullReceipt.animate([
    { transform: "translateY(0px)" },
    { transform: "translateY(200px)" }
  ], {
    duration: 600,
    easing: "ease-out",
    fill: "forwards"
  });

  setTimeout(() => {
    // Stage 1 종료 → Stage 2로 연결 (Fold Stage)
    goToFoldStage(pullReceipt.src);
  }, 650);
}
</script>

<style>
  /* Stage 1: pull dragging screen */
  #pullStage {
    position: fixed;
    inset: 0;
    background: white;
    display: none;
    justify-content: center;
    align-items: flex-start;
    overflow: hidden;
    z-index: 20;
  }

  #pullReceipt {
    width: 240px;
    position: absolute;
    top: 200px;
    cursor: grab;
    user-select: none;
  }

  /* Stage 2: floating folded receipt */
  #foldStage {
    position: fixed;
    inset: 0;
    background: black;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 30;
    opacity: 0;
    transition: opacity 1s ease;
  }

  #floatingReceipt {
    width: 260px;
    transform: rotateX(75deg);
    animation: float 3s ease-in-out infinite;
    cursor: pointer;
  }

  @keyframes float {
    0% { transform: translateY(0px) rotateX(75deg); }
    50% { transform: translateY(-12px) rotateX(75deg); }
    100% { transform: translateY(0px) rotateX(75deg); }
  }
</style>

<!-- Stage 1 -->
<div id="pullStage">
  <img src="slot.png" style="width: 500px;">
  <img id="pullReceipt" src="">
</div>

<!-- Stage 2 -->
<div id="foldStage">
  <img id="floatingReceipt" src="">
</div>

<script>
let pullStage = document.getElementById("pullStage");
let pullReceipt = document.getElementById("pullReceipt");

let foldStage = document.getElementById("foldStage");
let floatingReceipt = document.getElementById("floatingReceipt");

let pulling = false;
let startY = 0;
let receiptY = 200;
let maxPull = 600;

/* ========= Stage 1 시작 함수 ========= */
function startPullStage(receiptImage) {
  pullReceipt.src = receiptImage;
  pullStage.style.display = "flex";
}

/* ========= Stage 1 Drag logic ========= */
pullReceipt.addEventListener("mousedown", e => {
  pulling = true;
  startY = e.clientY;
  receiptY = parseFloat(pullReceipt.style.top);
});

window.addEventListener("mousemove", e => {
  if (!pulling) return;
  let dy = e.clientY - startY;
  let newY = receiptY + dy;

  if (newY < 200) newY = 200;
  pullReceipt.style.top = newY + "px";

  if (newY > maxPull) {
    completePull();
  }
});

window.addEventListener("mouseup", () => pulling = false);

/* ========= Stage 1 → Stage 2 전환 ========= */
function completePull() {
  pulling = false;

  pullReceipt.animate([
    { transform: "translateY(0px)" },
    { transform: "translateY(200px)" }
  ], {
    duration: 600,
    easing: "ease-out",
    fill: "forwards"
  });

  setTimeout(() => {
    goToFoldStage(pullReceipt.src);
  }, 650);
}

/* ========= Stage 2: Floating Folded Receipt ========= */
function goToFoldStage(receiptImage) {
  pullStage.style.display = "none";

  floatingReceipt.src = receiptImage;
  foldStage.style.display = "flex";

  // Fade-in
  requestAnimationFrame(() => {
    foldStage.style.opacity = 1;
  });
}

/* ========= Stage 2 → Stage 3 호출 (펼치기) ========= */
floatingReceipt.addEventListener("click", () => {
  // 다음 스테이지로 넘어가는 함수 (Stage 3) 호출
  startUnfoldStage(floatingReceipt.src);
});
</script>

<style>
  #unfoldStage {
    position: fixed;
    inset: 0;
    background: #0f0f0f;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 40;
    opacity: 0;
    transition: opacity 0.8s ease;
  }

  #unfoldReceipt {
    width: 280px;
    transform-origin: top;
    transform: rotateX(75deg);
    cursor: pointer;
    transition: transform 0.15s linear;
  }

  /* Right Panel */
  #detailPanel {
    position: fixed;
    right: 40px;
    top: 40px;
    width: 320px;
    height: 500px;
    padding: 20px;
    border-radius: 16px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    color: white;
    opacity: 0;
    transform: translateY(40px);
    transition: 0.6s ease;
    overflow-y: auto;
  }

  .d-block {
    opacity: 0;
    transform: translateX(-10px);
    margin-bottom: 20px;
    transition: 0.4s ease;
  }

  .d-block.visible {
    opacity: 1;
    transform: translateX(0);
  }
</style>

<!-- Stage 3 -->
<div id="unfoldStage">
  <img id="unfoldReceipt" src="">
  <div id="detailPanel">
    <h2 style="margin-top:0;">삭제된 장면 (Deleted Scenes)</h2>

    <div class="d-block" data-th="0.2">
      <b>1. 재료 독성</b>
      <p>영수증에 적히지 않는 화학물질, 염료, 접착제...</p>
    </div>

    <div class="d-block" data-th="0.45">
      <b>2. 노동 시간 & 임금</b>
      <p>보이지 않는 생산자의 손과 시간...</p>
    </div>

    <div class="d-block" data-th="0.65">
      <b>3. 탄소배출 / 에너지</b>
      <p>제품 생애 전체에 걸친 탄소발자국...</p>
    </div>

    <div class="d-block" data-th="0.85">
      <b>4. 환경적 외부비용</b>
      <p>폐기물, 생태계 손상, 수질 오염 등...</p>
    </div>
  </div>
</div>

<script>
let unfoldStage = document.getElementById("unfoldStage");
let unfoldReceipt = document.getElementById("unfoldReceipt");
let detailPanel = document.getElementById("detailPanel");
let detailBlocks = [...document.querySelectorAll(".d-block")];

/* =====================
   Stage 2 → Stage 3
   ===================== */
function startUnfoldStage(receiptImage) {
  unfoldReceipt.src = receiptImage;

  unfoldStage.style.display = "flex";
  requestAnimationFrame(() => {
    unfoldStage.style.opacity = 1;
  });
}

/* =====================
   펼치기 애니메이션
   ===================== */
let unfolded = false;
let fold = 75;

unfoldReceipt.addEventListener("click", () => {
  if (unfolded) return;

  let anim = setInterval(() => {
    fold -= 2.5;
    if (fold <= 0) {
      fold = 0;
      unfolded = true;
      clearInterval(anim);
    }

    unfoldReceipt.style.transform = `rotateX(${fold}deg)`;

    let progress = 1 - fold / 75; // 0.0 ~ 1.0

    if (progress > 0.1) {
      detailPanel.style.opacity = 1;
      detailPanel.style.transform = "translateY(0)";
    }

    detailBlocks.forEach(b => {
      let th = parseFloat(b.dataset.th);
      if (progress >= th) b.classList.add("visible");
    });
  }, 20);
});
</script>

<style>
  /* Full Detail Stage */
  #fullDetailStage {
    position: fixed;
    inset: 0;
    background: #f9f9f9;
    color: #222;
    font-family: -apple-system, BlinkMacSystemFont;
    overflow-y: auto;
    z-index: 999;
    display: none;
    opacity: 0;
    transition: opacity 0.8s ease;
  }

  .full-wrapper {
    width: 760px;
    margin: 60px auto;
    padding-bottom: 100px;
  }

  .full-title {
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 20px;
  }

  .section-title {
    font-size: 20px;
    font-weight: 700;
    margin-top: 40px;
    margin-bottom: 12px;
  }

  .section-text {
    font-size: 15px;
    line-height: 1.65;
    opacity: 0.85;
  }

  #detailClose {
    position: fixed;
    top: 20px;
    right: 30px;
    background: black;
    color: white;
    padding: 8px 16px;
    border-radius: 10px;
    font-size: 15px;
    cursor: pointer;
    opacity: 0.75;
    z-index: 1000;
  }

  #detailClose:hover {
    opacity: 1;
  }
</style>

<!-- Stage 4 -->
<div id="fullDetailStage">
  <div id="detailClose">Back</div>

  <div class="full-wrapper">
    <div id="fullDetailContent">
      <!-- JS로 내용 채움 -->
    </div>
  </div>
</div>

<script>
/* ========= Stage 3 → Stage 4 ========= */

function openFullDetailPage(type) {
  // type = product category (coffee/smartphone/ikea/tshirt)

  let stage = document.getElementById("fullDetailStage");
  let content = document.getElementById("fullDetailContent");

  // Example data
  const database = {
    coffee: {
      title: "캡슐커피 — Cradle-to-Cradle 분석",
      sections: [
        {
          name: "1. 재료 건강성 (Material Health)",
          text: "알루미늄 캡슐의 표면 코팅, PP 캡슐의 첨가제, PLA 캡슐의 잔류 산성도..."
        },
        {
          name: "2. 재료 순환성 (Circularity)",
          text: "알루미늄은 기술루프에서 무한 재활용 가능, PLA는 생물학적 루프..."
        },
        {
          name: "3. 탄소 & 에너지",
          text: "원두 농업의 탄소, 캡슐 제조, 유통 과정..."
        },
        {
          name: "4. 물 관리",
          text: "커피 농업 과정의 물 사용량 + 제조 공정의 용수 소모..."
        },
        {
          name: "5. 사회적 공정성",
          text: "농장 노동력 문제, 공정무역 여부, 재활용 노동의 투명성..."
        }
      ]
    },

    smartphone: {
      title: "스마트폰 — Cradle-to-Cradle 분석",
      sections: [ /* ... */ ]
    },

    ikea: {
      title: "저가 가구(IKEA) — Cradle-to-Cradle 분석",
      sections: [ /* ... */ ]
    },

    tshirt: {
      title: "패스트패션 티셔츠 — Cradle-to-Cradle 분석",
      sections: [ /* ... */ ]
    }
  };

  const item = database[type];
  let html = `
    <div class="full-title">${item.title}</div>
  `;

  item.sections.forEach(s => {
    html += `
      <div class="section-title">${s.name}</div>
      <div class="section-text">${s.text}</div>
    `;
  });

  content.innerHTML = html;

  stage.style.display = "block";
  requestAnimationFrame(() => {
    stage.style.opacity = 1;
  });
}

document.getElementById("detailClose").addEventListener("click", () => {
  let stage = document.getElementById("fullDetailStage");
  stage.style.opacity = 0;

  setTimeout(() => {
    stage.style.display = "none";
  }, 600);
});
</script>



