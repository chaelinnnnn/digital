<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Receipt – REAL shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <style>
    body {
      background:#f7f4ec;
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      overflow:hidden;
    }

    /* Receipt container (starts above viewport) */
    .receipt {
      background:#fffef9;
      padding:20px;
      border:1px solid #000;
      width:360px;
      font-family: monospace;
      white-space: pre-wrap;
      box-shadow: 8px 8px 0 #222;
      position: relative;

      /* start position: above screen */
      transform: translateY(-120%);
      opacity: 0;

      animation: drop 1.8s ease-out forwards,
                 vibrate 0.15s ease-in-out 1.8s 4;
    }

    /* Drop-down printer animation */
    @keyframes drop {
      0%   { transform: translateY(-120%); opacity: 0; }
      50%  { transform: translateY(-20%); opacity: 1; }
      65%  { transform: translateY(-10%); }
      80%  { transform: translateY(-6%); }
      100% { transform: translateY(0%); }
    }

    /* Small vibration after landing */
    @keyframes vibrate {
      0% { transform: translateY(0); }
      25% { transform: translateY(2px); }
      50% { transform: translateY(-1px); }
      75% { transform: translateY(1px); }
      100% { transform: translateY(0); }
    }

    /* printed receipt edges */
    .receipt::before,
    .receipt::after {
      content:"";
      position:absolute;
      left:0; right:0;
      height:6px;
      background-image: repeating-linear-gradient(
        to right,
        #000 0, #000 4px,
        transparent 4px, transparent 8px
      );
    }
    .receipt::before { top:0; }
    .receipt::after  { bottom:0; }

    .btn {
      margin-top:16px;
      padding:6px 14px;
      border:1px solid #000;
      background:#fff;
      cursor:pointer;
      display:block;
      width:fit-content;
    }

    /* printing… message */
    #print-msg {
      font-family: monospace;
      font-size: 14px;
      opacity:0.7;
      margin-bottom:20px;
      animation: fadeout 1.2s ease-out forwards;
    }

    @keyframes fadeout {
      0% { opacity:0; }
      50% { opacity:1; }
      100% { opacity:0; }
    }

  </style>
</head>

<body>

  <div id="print-msg">printing…</div>
  <div class="receipt" id="receipt"></div>

  <audio id="print-sound">
    <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=" type="audio/wav">
  </audio>

  <script>
    let bag = JSON.parse(localStorage.getItem("impactBag") || "[]");
    const receipt = document.getElementById("receipt");
    const printSound = document.getElementById("print-sound");

    function buildReceipt(){
      if(bag.length === 0){
        receipt.textContent = "No items.";
        return;
      }

      let totalL=0, totalE=0, totalC=0;
      let txt = "IMPACT RECEIPT\n";
      txt += "------------------------------------\n";
      txt += "Items purchased:\n\n";

      bag.forEach(i=>{
        txt += `• Labor ${i.labor}% / Environment ${i.env}% / CEO ${i.extra}×\n`;
        totalL += Number(i.labor);
        totalE += Number(i.env);
        totalC += Number(i.extra);
      });

      const n = bag.length;
      txt += "\n------------------------------------\n";
      txt += "Averages:\n";
      txt += `Labor        ${Math.round(totalL/n)}%\n`;
      txt += `Environment  ${Math.round(totalE/n)}%\n`;
      txt += `CEO ratio    ${Math.round(totalC/n)}×\n\n`;

      txt += `<button class="btn" onclick="back()">Back to shop</button>`;

      return txt;
    }

    // show receipt after short delay (mimics printing)
    setTimeout(()=>{
      printSound.volume = 0.4;
      printSound.play();

      receipt.innerHTML = buildReceipt();
    }, 900);

    function back(){
      localStorage.removeItem("impactBag");
      location.href = "index.html";
    }
  </script>

</body>
</html>
